import React, { useState, useEffect } from 'react';
import { Search, Filter, Calendar, User, ExternalLink } from 'lucide-react';

const LiveConnectorTracker = () => {
  const [searchTerm, setSearchTerm] = useState('');
  const [statusFilter, setStatusFilter] = useState('all');
  const [typeFilter, setTypeFilter] = useState('all');
  const [sortBy, setSortBy] = useState('recent');
  const [tickets, setTickets] = useState([]);

  // Simulated ticket data (in production, this comes from Jira API)
  useEffect(() => {
    const mockTickets = [
      {
        key: 'AIG-536',
        name: 'Enable Claude connectors: S&P Global, PitchBook, Moody\'s, LSEG, Morningstar, Crypto.com',
        status: 'approved',
        type: 'connector',
        platforms: ['Claude', 'S&P Global', 'PitchBook', 'Moody\'s'],
        date: '2026-02-14',
        owner: 'Sonal Mehta'
      },
      {
        key: 'AIG-404',
        name: 'Claude <>Excel, Powerpoint Files',
        status: 'approved',
        type: 'connector',
        platforms: ['Claude', 'Excel', 'PowerPoint'],
        date: '2026-01-15',
        owner: 'Sonal Mehta'
      },
      {
        key: 'AIG-499',
        name: 'Confluence<>ChatGPT',
        status: 'approved',
        type: 'connector',
        platforms: ['ChatGPT', 'Confluence'],
        date: '2026-01-28',
        owner: 'Sonal Mehta'
      },
      {
        key: 'AIG-277',
        name: 'Cursor VS Code<>Atlassian',
        status: 'approved',
        type: 'mcp',
        platforms: ['Cursor', 'VS Code', 'Jira', 'Confluence'],
        date: '2025-12-20',
        owner: 'Karim Ali'
      },
      {
        key: 'AIG-293',
        name: 'Atlassian<>Claude/Coding Agent',
        status: 'approved',
        type: 'mcp',
        platforms: ['Claude', 'Jira', 'Confluence'],
        date: '2025-12-05',
        owner: 'Karim Ali'
      },
      {
        key: 'AIG-271',
        name: 'Jira <>ChatGPT',
        status: 'approved',
        type: 'connector',
        platforms: ['ChatGPT', 'Jira'],
        date: '2025-11-15',
        owner: 'Sonal Mehta'
      },
      {
        key: 'AIG-270',
        name: 'Admin Authorization for Atlassian MCP Server in VS Code',
        status: 'approved',
        type: 'mcp',
        platforms: ['VS Code', 'Jira', 'Confluence'],
        date: '2025-11-28',
        owner: 'Karim Ali'
      },
      {
        key: 'AIG-448',
        name: 'Allow me to access MCP server to Solscan<>Cursor',
        status: 'in-progress',
        type: 'mcp',
        platforms: ['Cursor', 'Solscan'],
        date: '2026-01-05',
        owner: 'Sonal Mehta'
      },
      {
        key: 'AIG-457',
        name: 'Claude Extensions in Microsoft Office',
        status: 'in-progress',
        type: 'connector',
        platforms: ['Claude', 'Office'],
        date: '2026-01-08',
        owner: 'Sonal Mehta'
      },
      {
        key: 'AIG-459',
        name: 'ChatGPT <> Pitchbook',
        status: 'in-progress',
        type: 'connector',
        platforms: ['ChatGPT', 'PitchBook'],
        date: '2026-01-10',
        owner: 'Sonal Mehta'
      },
      {
        key: 'AIG-505',
        name: 'Claude for Legal',
        status: 'in-progress',
        type: 'connector',
        platforms: ['Claude', 'Legal'],
        date: '2026-02-01',
        owner: 'Sonal Mehta'
      },
      {
        key: 'AIG-412',
        name: 'Enable Cursor ‚Üî GitHub integration for Production Engineering',
        status: 'in-progress',
        type: 'mcp',
        platforms: ['Cursor', 'GitHub'],
        date: '2025-12-15',
        owner: 'Karim Ali'
      },
      {
        key: 'AIG-523',
        name: 'PagerDuty<>Various Tools',
        status: 'backlog',
        type: 'mcp',
        platforms: ['Multiple', 'PagerDuty'],
        date: '2026-02-10',
        owner: null
      },
      {
        key: 'AIG-508',
        name: 'Box<>ChatGPT, Claude',
        status: 'backlog',
        type: 'connector',
        platforms: ['ChatGPT', 'Claude', 'Box'],
        date: '2026-02-01',
        owner: null
      },
      {
        key: 'AIG-507',
        name: 'Databricks<>Cursor, VS Code',
        status: 'backlog',
        type: 'mcp',
        platforms: ['Cursor', 'VS Code', 'Databricks'],
        date: '2026-02-01',
        owner: null
      }
    ];

    setTickets(mockTickets);
  }, []);

  const filteredTickets = tickets.filter(ticket => {
    const matchesSearch = !searchTerm || 
      ticket.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
      ticket.platforms.some(p => p.toLowerCase().includes(searchTerm.toLowerCase())) ||
      ticket.key.toLowerCase().includes(searchTerm.toLowerCase());

    const matchesStatus = statusFilter === 'all' || ticket.status === statusFilter;
    const matchesType = typeFilter === 'all' || ticket.type === typeFilter;

    return matchesSearch && matchesStatus && matchesType;
  });

  const sortedTickets = [...filteredTickets].sort((a, b) => {
    if (sortBy === 'name') return a.name.localeCompare(b.name);
    if (sortBy === 'status') {
      const order = { approved: 1, 'in-progress': 2, backlog: 3 };
      return order[a.status] - order[b.status];
    }
    return 0;
  });

  const counts = {
    approved: tickets.filter(t => t.status === 'approved').length,
    inProgress: tickets.filter(t => t.status === 'in-progress').length,
    backlog: tickets.filter(t => t.status === 'backlog').length
  };

  const getStatusDisplay = (status) => {
    const map = {
      approved: { text: 'Approved', color: 'text-green-700', bg: 'bg-green-50', dot: 'bg-green-500' },
      'in-progress': { text: 'In Progress', color: 'text-yellow-700', bg: 'bg-yellow-50', dot: 'bg-yellow-500' },
      backlog: { text: 'Submitted', color: 'text-blue-700', bg: 'bg-blue-50', dot: 'bg-blue-500' }
    };
    return map[status];
  };

  return (
    <div className="min-h-screen bg-gray-50">
      {/* Header */}
      <div className="bg-gradient-to-r from-blue-600 to-blue-700 text-white">
        <div className="max-w-7xl mx-auto px-8 py-8">
          <h1 className="text-3xl font-semibold mb-2">üîå Connector/MCP Server Approval Tracker</h1>
          <p className="text-blue-100">Search and track all connector and MCP server approval requests in real-time</p>
        </div>
      </div>

      {/* Search & Filter Bar */}
      <div className="bg-white border-b-2 border-gray-200">
        <div className="max-w-7xl mx-auto px-8 py-6">
          <div className="flex flex-wrap gap-4 items-center">
            {/* Search Box */}
            <div className="flex-1 min-w-80 relative">
              <Search className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" />
              <input
                type="text"
                placeholder="Search by connector name, platform, or ticket number..."
                className="w-full pl-10 pr-4 py-2.5 border-2 border-gray-300 rounded-md focus:border-blue-500 focus:outline-none"
                value={searchTerm}
                onChange={(e) => setSearchTerm(e.target.value)}
              />
            </div>

            {/* Status Filter */}
            <div className="flex items-center gap-2">
              <span className="text-sm font-semibold text-gray-600">Status:</span>
              <div className="flex gap-2">
                {['all', 'approved', 'in-progress', 'backlog'].map(status => (
                  <button
                    key={status}
                    onClick={() => setStatusFilter(status)}
                    className={`px-4 py-2 text-sm font-medium rounded-md transition-all ${
                      statusFilter === status
                        ? 'bg-blue-600 text-white'
                        : 'bg-white border-2 border-gray-300 text-gray-700 hover:border-blue-500'
                    }`}
                  >
                    {status === 'all' ? 'All' : status === 'in-progress' ? 'In Progress' : status.charAt(0).toUpperCase() + status.slice(1)}
                  </button>
                ))}
              </div>
            </div>

            {/* Type Filter */}
            <div className="flex items-center gap-2">
              <span className="text-sm font-semibold text-gray-600">Type:</span>
              <div className="flex gap-2">
                {['all', 'connector', 'mcp'].map(type => (
                  <button
                    key={type}
                    onClick={() => setTypeFilter(type)}
                    className={`px-4 py-2 text-sm font-medium rounded-md transition-all ${
                      typeFilter === type
                        ? 'bg-blue-600 text-white'
                        : 'bg-white border-2 border-gray-300 text-gray-700 hover:border-blue-500'
                    }`}
                  >
                    {type === 'all' ? 'All' : type === 'mcp' ? 'MCP Server' : 'Connector'}
                  </button>
                ))}
              </div>
            </div>
          </div>
        </div>
      </div>

      {/* Stats Bar */}
      <div className="bg-gray-50 border-b-2 border-gray-200">
        <div className="max-w-7xl mx-auto px-8 py-4">
          <div className="flex gap-8 items-center">
            <div className="flex items-center gap-2">
              <span className="text-3xl font-bold text-green-600">{counts.approved}</span>
              <span className="text-sm text-gray-600">Approved/Enabled</span>
            </div>
            <div className="flex items-center gap-2">
              <span className="text-3xl font-bold text-yellow-600">{counts.inProgress}</span>
              <span className="text-sm text-gray-600">In Progress</span>
            </div>
            <div className="flex items-center gap-2">
              <span className="text-3xl font-bold text-blue-600">{counts.backlog}</span>
              <span className="text-sm text-gray-600">Backlog/Submitted</span>
            </div>
            <div className="ml-auto flex items-center gap-2 text-sm text-gray-500">
              <div className="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
              <span>Auto-synced from Jira</span>
            </div>
          </div>
        </div>
      </div>

      {/* Content */}
      <div className="max-w-7xl mx-auto px-8 py-8">
        {/* Results Header */}
        <div className="flex justify-between items-center mb-6">
          <div className="text-sm text-gray-600">
            Showing {sortedTickets.length} connector{sortedTickets.length !== 1 ? 's' : ''}
          </div>
          <select
            value={sortBy}
            onChange={(e) => setSortBy(e.target.value)}
            className="px-3 py-2 border-2 border-gray-300 rounded-md text-sm"
          >
            <option value="recent">Sort by: Most Recent</option>
            <option value="name">Sort by: Name (A-Z)</option>
            <option value="status">Sort by: Status</option>
          </select>
        </div>

        {/* Ticket List */}
        {sortedTickets.length === 0 ? (
          <div className="text-center py-20">
            <div className="text-6xl mb-4 opacity-20">üîç</div>
            <div className="text-lg font-semibold text-gray-700 mb-2">No results found</div>
            <div className="text-sm text-gray-500">Try adjusting your search or filters</div>
          </div>
        ) : (
          <div className="space-y-3">
            {sortedTickets.map(ticket => {
              const statusInfo = getStatusDisplay(ticket.status);
              return (
                <div
                  key={ticket.key}
                  className="bg-white border-2 border-gray-200 rounded-lg p-5 hover:border-blue-500 hover:shadow-md transition-all cursor-pointer"
                  onClick={() => window.open(`https://galaxydig.atlassian.net/browse/${ticket.key}`, '_blank')}
                >
                  <div className="grid grid-cols-12 gap-4 items-center">
                    {/* Ticket Key */}
                    <div className="col-span-1">
                      <div className="font-mono text-xs font-bold text-blue-600">{ticket.key}</div>
                    </div>

                    {/* Ticket Details */}
                    <div className="col-span-5">
                      <div className="font-semibold text-gray-900 mb-1.5">{ticket.name}</div>
                      <div className="flex flex-wrap gap-1.5">
                        {ticket.platforms.map(platform => (
                          <span key={platform} className="px-2 py-1 bg-gray-100 text-gray-600 text-xs font-medium rounded">
                            {platform}
                          </span>
                        ))}
                      </div>
                      <div className="text-xs text-gray-500 mt-1">{ticket.type === 'mcp' ? 'MCP Server' : 'Connector'}</div>
                    </div>

                    {/* Status */}
                    <div className="col-span-2">
                      <div className="flex items-center gap-2">
                        <div className={`w-2 h-2 rounded-full ${statusInfo.dot}`}></div>
                        <span className={`text-sm font-semibold ${statusInfo.color}`}>
                          {statusInfo.text}
                        </span>
                      </div>
                    </div>

                    {/* Date */}
                    <div className="col-span-2">
                      <div className="flex items-center gap-2 text-sm text-gray-600">
                        <Calendar className="w-4 h-4" />
                        <span>{new Date(ticket.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</span>
                      </div>
                    </div>

                    {/* Owner */}
                    <div className="col-span-2">
                      <div className="flex items-center gap-2 text-sm text-gray-600">
                        <User className="w-4 h-4" />
                        <span>{ticket.owner || '‚Äî'}</span>
                      </div>
                    </div>
                  </div>
                </div>
              );
            })}
          </div>
        )}

        {/* Footer */}
        <div className="mt-8 pt-6 border-t-2 border-gray-200">
          <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
            <div className="flex items-start gap-3">
              <div className="text-blue-600 font-semibold">‚ÑπÔ∏è</div>
              <div className="text-sm text-gray-700">
                This page is automatically synchronized with Jira epic{' '}
                <a href="https://galaxydig.atlassian.net/browse/AIG-276" className="text-blue-600 font-semibold hover:underline" target="_blank" rel="noopener noreferrer">
                  AIG-276
                </a>
                . Status updates appear within 1 minute of Jira ticket changes. For new requests, please use the{' '}
                <a href="https://galaxydig.atlassian.net/servicedesk/customer/portal/251/group/340/create/1631" className="text-blue-600 font-semibold hover:underline" target="_blank" rel="noopener noreferrer">
                  intake form
                </a>.
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

export default LiveConnectorTracker;
